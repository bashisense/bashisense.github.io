

<!DOCTYPE html>
<html class="writer-html5" lang="cn" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>构建说明 &mdash; WalOS SDK 2.2.0 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> WalOS SDK
          

          
          </a>

          
            
            
              <div class="version">
                2.2.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <!-- Local TOC -->
              <div class="local-toc"><ul>
<li><a class="reference internal" href="#">构建说明</a><ul>
<li><a class="reference internal" href="#id2">1. 代码结构</a></li>
<li><a class="reference internal" href="#sdk">2. 构建SDK</a></li>
<li><a class="reference internal" href="#id3">3. 编译依赖库</a><ul>
<li><a class="reference internal" href="#id4">编译</a><ul>
<li><a class="reference internal" href="#deps-luajit-2-1-0-beta3">1. deps/LuaJIT-2.1.0-beta3</a></li>
<li><a class="reference internal" href="#deps-luafilesystem-1-7-0-2">2. deps/luafilesystem-1_7_0_2</a></li>
<li><a class="reference internal" href="#deps-luasocket-3-0-rc1">3. deps/luasocket-3.0-rc1</a></li>
<li><a class="reference internal" href="#deps-freetype-2-4-0">4. deps/freetype-2.4.0</a></li>
<li><a class="reference internal" href="#deps-lvgl-7-0-0">5. deps/lvgl-7.0.0</a></li>
<li><a class="reference internal" href="#deps-openssl-openssl-1-0-2u">6. deps/openssl-OpenSSL_1_0_2u</a></li>
<li><a class="reference internal" href="#deps-turbo-2-1-3">7. deps/turbo-2.1.3</a></li>
<li><a class="reference internal" href="#deps-libevent-2-1-11-stable">8. deps/libevent-2.1.11-stable</a></li>
<li><a class="reference internal" href="#deps-sqlite-autoconf-3310100">9. deps/sqlite-autoconf-3310100</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#id5">###打包</a></li>
<li><a class="reference internal" href="#id6">4. 制做安装包</a></li>
</ul>
</li>
</ul>
</div>
            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">WalOS SDK</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>构建说明</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/01.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="id1">
<h1>构建说明<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h1>
<div class="section" id="id2">
<h2>1. 代码结构<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Walos根目录：
|--deps        // 依赖的第三方库目录
|--docs        // 文档目录
|--dv300       // Hi3516DV300平台目标文件
|--macosx      // MacOS平台目标文件
|--release     // 发布文件，包括各种资源文件、配置等
|--ubuntu      // ubuntu amd64平台目标文件
|--xm6xx       // XM630/650平台目标文件
</pre></div>
</div>
</div>
<div class="section" id="sdk">
<h2>2. 构建SDK<a class="headerlink" href="#sdk" title="Permalink to this headline">¶</a></h2>
<p>构建过程为分两步：</p>
<ol class="simple">
<li><p>配置运行环境：</p></li>
</ol>
<ul class="simple">
<li><p>确认目标平台已经安装了工具链，并且命令行环境可以搜索到相应命令:PATH设置正确</p></li>
<li><p>整个WalOS的构建需要luajit-2.1.0-beta3版本，确认已安装此工具</p></li>
<li><p>Git库取整个库</p></li>
</ul>
<ol>
<li><p>进入deps目录，构建依赖库；</p>
<p><em><strong>其它问题,luajit ffi.load会使用系统的动态库连接，而我们的环境有ssl,crypto动态库，所以最佳的方案是把libtffi_wrap.so, libsqlite3.so复制到一个单独的目录，并采用export LD_LIBRARY_PATH=该目录，解决luajit ffi.load找不到动态库的问题。</strong></em></p>
</li>
</ol>
</div>
<div class="section" id="id3">
<h2>3. 编译依赖库<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h2>
<p>WalOS-SDK主要包括WalOS所需要的依赖库，他们主要有几组组成：</p>
<ol class="simple">
<li><p>lua组，包括：LuaJIT-2.1.0-beta3, luafilesystem-1_7_0_2, luasocket-3.0-rc1，编译时请按此顺序编译；</p></li>
<li><p>gui组，包括：freetype-2.4.0, lvgl-7.0.0，编译时请按此顺序编译；</p></li>
<li><p>turbo组，包括：openssl-OpenSSL_1_0_2u, turbo-2.1.3，编译时请按此顺序编译；</p></li>
<li><p>libevent组，包括：libevent-2.1.11-stable，</p></li>
<li><p>sqlite组，包括：sqlite-autoconf-3310100</p></li>
</ol>
<p>Linux平台以XM650平台为例，ubuntu、Hi3516DV300平台类似，工具链的安装目录可以根据需求安装，没有强制要求；</p>
<ul class="simple">
<li><p>XM650平台工具链安装目录：/opt/xm_toolchain/arm-xm-linux/usr/bin</p></li>
<li><p>DV300平台工具链安装目录：/opt/hisi-toolchain</p></li>
</ul>
<div class="section" id="id4">
<h3>编译<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<hr class="docutils" />
<div class="section" id="deps-luajit-2-1-0-beta3">
<h4>1. deps/LuaJIT-2.1.0-beta3<a class="headerlink" href="#deps-luajit-2-1-0-beta3" title="Permalink to this headline">¶</a></h4>
<ol class="simple">
<li><p>修改 src/Makefile：
#XCFLAGS+= -DLUAJIT_ENABLE_GC64     // 关闭此选项，macosx/ubuntu需要打开此选项
BUILDMODE= static                   // 编译静态方式</p></li>
<li><p>make HOST_CC=&quot;gcc -m32&quot; CROSS=arm-xm-linux- PREFIX=/path/to/you/dir all install</p></li>
</ol>
</div>
<div class="section" id="deps-luafilesystem-1-7-0-2">
<h4>2. deps/luafilesystem-1_7_0_2<a class="headerlink" href="#deps-luafilesystem-1-7-0-2" title="Permalink to this headline">¶</a></h4>
<ol class="simple">
<li><p>make cc=arm-xm-linux-gcc PREFIX=/path/to/you/dir install</p></li>
</ol>
</div>
<div class="section" id="deps-luasocket-3-0-rc1">
<h4>3. deps/luasocket-3.0-rc1<a class="headerlink" href="#deps-luasocket-3-0-rc1" title="Permalink to this headline">¶</a></h4>
<ol class="simple">
<li><p>make PLAT=linux CC_linux=arm-xm-linux-gcc LD_linux=arm-xm-linux-gcc PREFIX=/path/to/you/dir</p></li>
<li><p>make install</p></li>
</ol>
</div>
<div class="section" id="deps-freetype-2-4-0">
<h4>4. deps/freetype-2.4.0<a class="headerlink" href="#deps-freetype-2-4-0" title="Permalink to this headline">¶</a></h4>
<ol class="simple">
<li><p>./configure --disable-shared --enable-static --without-fsspec --without-fsref -without-quickdraw-toolbox --without-quickdraw-carbon --without-ats --with-pic  --without-zlib --prefix=/path/to/you/dir --host=arm-xm-linux</p></li>
<li><p>make all install</p></li>
</ol>
</div>
<div class="section" id="deps-lvgl-7-0-0">
<h4>5. deps/lvgl-7.0.0<a class="headerlink" href="#deps-lvgl-7-0-0" title="Permalink to this headline">¶</a></h4>
<ol class="simple">
<li><p>lv_config.h</p></li>
</ol>
<ul class="simple">
<li><p>#define LV_HOR_RES_MAX      (480)</p></li>
<li><p>#define LV_VER_RES_MAX      (800)</p></li>
<li><p>#define LV_COLOR_DEPTH      16</p></li>
</ul>
<ol class="simple">
<li><p>make -f Makefile.xm6xx PREFIX=/path/to/you/dir</p></li>
</ol>
</div>
<div class="section" id="deps-openssl-openssl-1-0-2u">
<h4>6. deps/openssl-OpenSSL_1_0_2u<a class="headerlink" href="#deps-openssl-openssl-1-0-2u" title="Permalink to this headline">¶</a></h4>
<ol class="simple">
<li><p>./Configure linux-generic32 --prefix=/path/to/you/dir --openssldir=/path/to/you/dir/openssl shared</p></li>
<li><p>make CC=arm-xm-linux-gcc RANLIB=arm-xm-linux-ranlib LD=arm-xm-linux-ld MAKEDEPPROG=arm-xm-linux-gcc PROCESSOR=ARM all install</p></li>
</ol>
</div>
<div class="section" id="deps-turbo-2-1-3">
<h4>7. deps/turbo-2.1.3<a class="headerlink" href="#deps-turbo-2-1-3" title="Permalink to this headline">¶</a></h4>
<ol class="simple">
<li><p>make PREIFX=/path/to/you/dir CC = arm-xm-linux-gcc all install</p></li>
</ol>
</div>
<div class="section" id="deps-libevent-2-1-11-stable">
<h4>8. deps/libevent-2.1.11-stable<a class="headerlink" href="#deps-libevent-2-1-11-stable" title="Permalink to this headline">¶</a></h4>
<ol class="simple">
<li><p>./configure --disable-shared --prefix=/path/to/you/dir --host=arm-xm-linux</p></li>
<li><p>make all install</p></li>
</ol>
</div>
<div class="section" id="deps-sqlite-autoconf-3310100">
<h4>9. deps/sqlite-autoconf-3310100<a class="headerlink" href="#deps-sqlite-autoconf-3310100" title="Permalink to this headline">¶</a></h4>
<ol class="simple">
<li><p>./configure --host=arm-xm-linux --prefix=/path/to/you/dir</p></li>
<li><p>make all install</p></li>
</ol>
</div>
</div>
</div>
<div class="section" id="id5">
<h2>###打包<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="id6">
<h2>4. 制做安装包<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h2>
<ol class="simple">
<li><p>进入平台目录，如xm6xx，创建WalOS子目录，并进入子目录；</p></li>
<li><p>复制$(WalOS-SDK)/release目录下的gui,openssl, data, modules目录到此目录；</p></li>
<li><p>复制$(WalOS-SDK)/release目录下的default.json 到此目录；</p></li>
<li><p>复制$(WalOS-SDK)/xm6xx/lib 目录到此目录，删除所有非动态库文件</p></li>
<li><p>创建app目录，编译WalOS的lua代码，包复制到此目录；</p></li>
<li><p>编译WalOS C代码，并复制到此目录；</p></li>
</ol>
<p><em><strong>注意:目标设备上，需要配置LD_LIBRARY_PATH环境变量指向lib目录；</strong></em></p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, bashisense

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>